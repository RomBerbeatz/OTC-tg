<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å - OTC Marketplace</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --tg-theme-bg-color: #f8f9fa;
            --tg-theme-text-color: #000000;
            --tg-theme-button-color: #2481cc;
        }
        
        body {
            background-color: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .navbar {
            background: white !important;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-bottom: 1px solid #eee;
        }
        
        .navbar-brand {
            font-weight: bold;
            color: var(--tg-theme-button-color) !important;
        }
        
        .stats-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.2s;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
        }
        
        .listing-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.2s;
            margin-bottom: 1rem;
        }
        
        .listing-card:hover {
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background: var(--tg-theme-button-color);
            border: none;
            border-radius: 10px;
        }
        
        .btn-primary:hover {
            background: #1a6bb8;
        }
        
        .welcome-section {
            background: linear-gradient(135deg, var(--tg-theme-button-color), #764ba2);
            color: white;
            padding: 2rem;
            border-radius: 20px;
            margin-bottom: 2rem;
        }
        
        .quick-actions {
            margin-bottom: 2rem;
        }
        
        .action-btn {
            border: none;
            border-radius: 15px;
            padding: 1rem;
            margin: 0.5rem;
            background: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.2s;
            text-decoration: none;
            color: #333;
            display: inline-block;
            min-width: 150px;
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            color: #333;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –±–µ–∑ –∫–Ω–æ–ø–∫–∏ "–í—ã–π—Ç–∏" -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="/">
                üè™ OTC Marketplace
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">
                    üëã {{ user.first_name }}
                </span>
                <a href="/" class="nav-link">
                    <i class="bi bi-house"></i> –ù–∞ –≥–ª–∞–≤–Ω—É—é
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
        <div class="welcome-section">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-2">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å üëã</h1>
                    <p class="mb-0">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.first_name }}! –£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏–º–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º–∏ –∏ —Å–¥–µ–ª–∫–∞–º–∏</p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="badge bg-white text-dark fs-6 p-2">
                        üÜî ID: {{ user.id }}
                    </div>
                </div>
            </div>
        </div>

        <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div class="quick-actions">
            <h5 class="mb-3">‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h5>
            <div class="row text-center">
                <div class="col-md-3">
                    <a href="/create" class="action-btn">
                        <i class="bi bi-plus-circle fs-1 text-success"></i>
                        <div class="mt-2">
                            <strong>–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</strong>
                            <br><small>–ü—Ä–æ–¥–∞—Ç—å —Ç–æ–≤–∞—Ä</small>
                        </div>
                    </a>
                </div>
                <div class="col-md-3">
                    <a href="/messages" class="action-btn">
                        <i class="bi bi-chat-dots fs-1 text-primary"></i>
                        <div class="mt-2">
                            <strong>–°–æ–æ–±—â–µ–Ω–∏—è</strong>
                            <br><small>{{ messages|length }} –Ω–æ–≤—ã—Ö</small>
                        </div>
                    </a>
                </div>
                <div class="col-md-3">
                    <a href="#" class="action-btn">
                        <i class="bi bi-person-circle fs-1 text-info"></i>
                        <div class="mt-2">
                            <strong>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</strong>
                            <br><small>–ü—Ä–æ—Ñ–∏–ª—å</small>
                        </div>
                    </a>
                </div>
                <div class="col-md-3">
                    <a href="/" class="action-btn">
                        <i class="bi bi-shop fs-1 text-warning"></i>
                        <div class="mt-2">
                            <strong>–ü–ª–æ—â–∞–¥–∫–∞</strong>
                            <br><small>–í—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</small>
                        </div>
                    </a>
                </div>
            </div>
        </div>

        <!-- –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card stats-card text-center">
                    <div class="card-body">
                        <i class="bi bi-list-ul fs-1 text-primary"></i>
                        <h3 class="mt-2">{{ listings|length }}</h3>
                        <p class="text-muted mb-0">–ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card text-center">
                    <div class="card-body">
                        <i class="bi bi-eye fs-1 text-success"></i>
                        <h3 class="mt-2">{{ listings|sum(attribute='views')|int }}</h3>
                        <p class="text-muted mb-0">–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card text-center">
                    <div class="card-body">
                        <i class="bi bi-chat-dots fs-1 text-info"></i>
                        <h3 class="mt-2">{{ messages|length }}</h3>
                        <p class="text-muted mb-0">–°–æ–æ–±—â–µ–Ω–∏–π</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stats-card text-center">
                    <div class="card-body">
                        <i class="bi bi-currency-dollar fs-1 text-warning"></i>
                        <h3 class="mt-2">
                            <!-- –ò–°–ü–†–ê–í–õ–ï–ù–û: —É–±—Ä–∞–Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ -->
                            {% set ns = namespace(total=0) %}
                            {% for listing in listings %}
                                {% set ns.total = ns.total + listing.price %}
                            {% endfor %}
                            ${{ "%.1f"|format(ns.total) }}
                        </h3>
                        <p class="text-muted mb-0">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è -->
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5>üìã –ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</h5>
                    <a href="/create" class="btn btn-primary">
                        <i class="bi bi-plus"></i> –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ
                    </a>
                </div>

                {% if listings %}
                    <div class="row">
                        {% for listing in listings %}
                        <div class="col-md-6 col-lg-4 mb-3">
                            <div class="card listing-card h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <span class="badge bg-primary">
                                            {% if listing.category == 'channel' %}üì¢ –ö–ê–ù–ê–õ
                                            {% elif listing.category == 'account' %}üë§ –ê–ö–ö–ê–£–ù–¢
                                            {% else %}üéÅ –î–†–£–ì–û–ï
                                            {% endif %}
                                        </span>
                                        <small class="text-muted">{{ listing.created_at[:10] }}</small>
                                    </div>
                                    
                                    <h6 class="card-title">{{ listing.title }}</h6>
                                    <p class="card-text text-muted">{{ listing.description[:100] }}{% if listing.description|length > 100 %}...{% endif %}</p>
                                    
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <!-- –ò–°–ü–†–ê–í–õ–ï–ù–û: —É–±—Ä–∞–Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–µ–Ω—É –∫–∞–∫ –µ—Å—Ç—å -->
                                        <span class="h5 text-success mb-0">
                                            ${{ "%.1f"|format(listing.price) }}
                                        </span>
                                        <span class="badge bg-{{ 'success' if listing.status == 'active' else 'secondary' }}">
                                            {{ '‚úÖ –ê–∫—Ç–∏–≤–Ω–æ' if listing.status == 'active' else '‚è∏Ô∏è –ù–µ–∞–∫—Ç–∏–≤–Ω–æ' }}
                                        </span>
                                    </div>
                                    
                                    <!-- –î–û–ë–ê–í–õ–ï–ù–û: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–π -->
                                    <div class="row text-center mb-3">
                                        <div class="col-4">
                                            <small class="text-muted">–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</small>
                                            <div class="fw-bold">{{ listing.views or 0 }}</div>
                                        </div>
                                        <div class="col-4">
                                            <small class="text-muted">–°–æ–æ–±—â–µ–Ω–∏–π</small>
                                            <div class="fw-bold">
                                                <!-- –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è -->
                                                {% set listing_messages = messages|selectattr('listing_id', 'equalto', listing.id)|list %}
                                                {{ listing_messages|length }}
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            {% if listing.subscribers_count and listing.subscribers_count > 0 %}
                                            <small class="text-muted">–ü–æ–¥–ø–∏—Å—á–∏–∫–æ–≤</small>
                                            <div class="fw-bold">{{ '{:,}'.format(listing.subscribers_count).replace(',', ' ') }}</div>
                                            {% else %}
                                            <small class="text-muted">ID</small>
                                            <div class="fw-bold">#{{ listing.id }}</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- –ò–°–ü–†–ê–í–õ–ï–ù–û: —É–±—Ä–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" -->
                                <div class="card-footer bg-transparent">
                                    <div class="btn-group w-100" role="group">
                                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="editListing({{ listing.id }})">
                                            <i class="bi bi-pencil"></i> –ò–∑–º–µ–Ω–∏—Ç—å
                                        </button>
                                        <button type="button" class="btn btn-outline-danger btn-sm" onclick="deleteListing({{ listing.id }}, '{{ listing.title|replace("'", "\\'") }}')">
                                            <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <i class="bi bi-inbox display-1 text-muted"></i>
                        <h4>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π</h4>
                        <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –∏ –Ω–∞—á–Ω–∏—Ç–µ –ø—Ä–æ–¥–∞–≤–∞—Ç—å!</p>
                        <a href="/create" class="btn btn-primary btn-lg">
                            <i class="bi bi-plus"></i> –°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è -->
        {% if messages %}
        <div class="row mt-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5>üí¨ –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è</h5>
                    <a href="/messages" class="btn btn-outline-primary">
                        –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                    </a>
                </div>

                <div class="row">
                    {% for message in messages[:3] %}
                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <strong>{{ message.from_user_name }}</strong>
                                    <small class="text-muted">{{ message.created_at[:10] }}</small>
                                </div>
                                <h6 class="card-subtitle mb-2 text-muted">{{ message.listing_title }}</h6>
                                <p class="card-text">{{ message.message[:100] }}{% if message.message|length > 100 %}...{% endif %}</p>
                                <span class="badge bg-{{ 'warning' if message.status == 'unread' else 'secondary' }}">
                                    {{ '–ù–æ–≤–æ–µ' if message.status == 'unread' else '–ü—Ä–æ—á–∏—Ç–∞–Ω–æ' }}
                                </span>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - —É–±—Ä–∞–Ω–∞ "–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥" -->
        <div class="row mt-4 mb-5">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">üìä –í–∞—à–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h5>
                        <div class="row text-center">
                            <div class="col-md-4">
                                <div class="border rounded p-3">
                                    <i class="bi bi-calendar-check fs-3 text-primary"></i>
                                    <div class="mt-2">
                                        <strong>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</strong>
                                        <br><small class="text-muted">15 –∏—é–Ω—è 2025</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="border rounded p-3">
                                    <i class="bi bi-star-fill fs-3 text-warning"></i>
                                    <div class="mt-2">
                                        <strong>–†–µ–π—Ç–∏–Ω–≥</strong>
                                        <br><small class="text-muted">5.0 ‚≠ê</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="border rounded p-3">
                                    <i class="bi bi-handshake fs-3 text-info"></i>
                                    <div class="mt-2">
                                        <strong>–°–¥–µ–ª–∫–∏</strong>
                                        <br><small class="text-muted">0 –∑–∞–≤–µ—Ä—à–µ–Ω–æ</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">üóëÔ∏è –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ?</p>
                    <p class="fw-bold text-primary" id="deleteListingTitle"></p>
                    <p class="text-muted">–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x"></i> –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                        <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Telegram WebApp
        let tg = window.Telegram?.WebApp;
        if (tg) {
            tg.expand();
            tg.ready();
        }

        console.log('üë§ –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: RomBerbeatz');
        console.log('üìÖ –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: 2025-06-15 21:16:17 UTC');
        console.log('‚úÖ –î–∞—à–±–æ—Ä–¥ –æ–±–Ω–æ–≤–ª–µ–Ω - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ü–µ–Ω—ã, —É–±—Ä–∞–Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è');

        let listingToDelete = null;

        // –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω —á–µ—Ä–µ–∑ JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ü–µ–Ω–∞–º–∏ –∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º
            document.querySelectorAll('.text-success').forEach(priceElement => {
                const priceText = priceElement.textContent.replace('$', '');
                const price = parseFloat(priceText);
                if (!isNaN(price)) {
                    priceElement.textContent = `$${price.toFixed(1)}`;
                    console.log(`üí∞ –¶–µ–Ω–∞ –≤ –æ–±—ä—è–≤–ª–µ–Ω–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∞: ${price} ‚Üí $${price.toFixed(1)}`);
                }
            });
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
            const totalPriceElement = document.querySelector('.bi-currency-dollar').closest('.card-body').querySelector('h3');
            if (totalPriceElement) {
                const totalText = totalPriceElement.textContent.replace('$', '');
                const total = parseFloat(totalText);
                if (!isNaN(total)) {
                    totalPriceElement.textContent = `$${total.toFixed(1)}`;
                    console.log(`üí∞ –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞: ${total} ‚Üí $${total.toFixed(1)}`);
                }
            }
            
            // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫
            const cards = document.querySelectorAll('.stats-card, .listing-card');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    card.style.transition = 'all 0.5s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 50);
            });
            
            console.log('‚ú® –ê–Ω–∏–º–∞—Ü–∏–∏ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω –∑–∞–≤–µ—Ä—à–µ–Ω—ã');
        });

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
        function editListing(listingId) {
            console.log('‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è ID:', listingId);
            
            if (tg) {
                tg.showAlert('–§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏');
            } else {
                alert('–§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏');
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
        function deleteListing(listingId, listingTitle) {
            console.log('üóëÔ∏è –ó–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è ID:', listingId, listingTitle);
            
            listingToDelete = listingId;
            document.getElementById('deleteListingTitle').textContent = listingTitle;
            new bootstrap.Modal(document.getElementById('deleteModal')).show();
        }

        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
        document.getElementById('confirmDeleteBtn').addEventListener('click', async function() {
            if (!listingToDelete) return;
            
            const btn = this;
            const originalText = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>–£–¥–∞–ª–µ–Ω–∏–µ...';
            
            try {
                const response = await fetch(`/api/listings/${listingToDelete}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                    bootstrap.Modal.getInstance(document.getElementById('deleteModal')).hide();
                    
                    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    if (tg) {
                        tg.showAlert('‚úÖ –û–±—ä—è–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ');
                    } else {
                        alert('‚úÖ –û–±—ä—è–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ');
                    }
                    
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    setTimeout(() => location.reload(), 1000);
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è');
                }
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
                listingToDelete = null;
            }
        });
    </script>
</body>
</html>